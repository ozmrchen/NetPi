# Week 1.3 Code Practice: Automate Network Commands

## Automate the Essential Four
**Time:** 20 minutes | **Rule:** Maximum 5 lines per script!

---

## Script 1: Auto Ping Test (5 minutes)

Create `auto_ping.py`:

```python
from scapy.all import IP, ICMP, sr1

hosts = ['127.0.0.1', '192.168.1.1', 'google.com']

for host in hosts:
    pkt = IP(dst=host)/ICMP()   # build ICMP echo request
    reply = sr1(pkt, timeout=2, verbose=0)
    print(f"{host}: {'‚úÖ UP' if reply else '‚ùå DOWN'}")
```

**Run:** `sudo python3 auto_ping.py`

---

## Script 2: Port Scanner (5 minutes)

Create `check_ports.py`:

```python
from scapy.all import IP, TCP, sr1

target = "127.0.0.1"     # localhost
ports = [22, 80, 443, 8080, 3306]  # common ports to test
open_ports = []

for port in ports:
    pkt = IP(dst=target)/TCP(dport=port, flags="S")   # TCP SYN
    reply = sr1(pkt, timeout=1, verbose=0)
    if reply and reply.haslayer(TCP) and reply[TCP].flags & 0x12:  # SYN-ACK
        open_ports.append(port)

print(f"Open ports: {len(open_ports)}")
for p in open_ports[:3]:   # Show first 3
    print(f"  {target}:{p}")
```

**Run:** `sudo python3 check_ports.py`

---

## Script 3: Network Info Grabber (5 minutes)

Create `network_info.py`:

```python
import socket
from scapy.all import conf

# My IP (no traffic sent)
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.connect(("8.8.8.8", 80))
my_ip = s.getsockname()[0]
s.close()

# Default gateway via OS routing table
_, gw, iface = conf.route.route("8.8.8.8")

print(f"Me: {my_ip} ‚Üí Router: {gw} (iface {iface})")
```

**Run:** `python3 network_info.py`

---

## Script 4: Quick Path Trace (5 minutes)

Create `trace_path.py`:

```python
from scapy.all import IP, ICMP, sr1

target = "google.com"
max_hops = 5
hops = 0

for ttl in range(1, max_hops + 1):
    pkt = IP(dst=target, ttl=ttl)/ICMP()   # send ICMP Echo with TTL
    reply = sr1(pkt, timeout=2, verbose=0)
    if reply:
        hops += 1
        if reply.type == 0:  # Echo reply ‚Üí reached destination
            break

print(f"Path to {target}: {hops} hops")
if hops > 10:
    print("Long path - might be slow")
```

**Run:** `sudo python3 trace_path.py`

---

## Challenge: Network Health Check

Create `health_check.py`:

```python
## Challenge: Network Health Check

Create `health_check.py`:

```python
from scapy.all import IP, ICMP, TCP, sr1

# Test connectivity with ICMP
pkt = IP(dst="google.com")/ICMP()
reply = sr1(pkt, timeout=2, verbose=0)
ping_ok = reply is not None

# Check some common ports on localhost
target = "127.0.0.1"
test_ports = [22, 80, 443, 8080, 3306]
open_ports = []

for port in test_ports:
    syn = IP(dst=target)/TCP(dport=port, flags="S")
    ans = sr1(syn, timeout=1, verbose=0)
    if ans and ans.haslayer(TCP) and ans[TCP].flags & 0x12:  # SYN-ACK
        open_ports.append(port)

print(f"Internet: {'‚úÖ' if ping_ok else '‚ùå'} | Open ports: {len(open_ports)}")
if open_ports:
    print("Ports:", ", ".join(str(p) for p in open_ports))
```

**Run:** `sudo python3 health_check.py`

üëâ Extension: Instead of checking just a few ports, try scanning a **range (1‚Äì1024)** as shown above and see how many open ports you can discover.

---

## What You Learned
- **Automation:** Python can run any network command
- **Status checking:** Automate connectivity tests  
- **Information gathering:** Extract network data programmatically
- **Health monitoring:** Combine multiple checks

---

## Quick Test
1. Which Python module runs command-line tools?
2. How do you check if a ping succeeded?
3. Why automate these commands instead of typing them?
