# Week 2.1 Code Practice: Basic Threat Detection Scanner

## Automate Your Vulnerability Discovery
**Time:** 20 minutes | **Rule:** Maximum 5 lines per script!  
**Environment:** Raspberry Pi OS / Linux (Codespaces compatible)

---

## Setup Check

**If commands are missing on Raspberry Pi:**
```bash
sudo apt-get update
sudo apt-get install -y iproute2 iputils-ping traceroute
```

---

## Script 1: Quick Threat Check (5 minutes)

Create `threat_check.py`:

```python
import socket

RISKY = [22, 23, 80, 445, 3389, 5000, 8080, 8888]  # Common risky + development ports


def is_open(p, host="127.0.0.1", t=0.5):
    try:
        with socket.create_connection((host, p), timeout=t):
            return True
    except Exception:
        return False


for p in RISKY:
    print(f"Port {p}: {'üö® OPEN' if is_open(p) else '‚úÖ CLOSED'}")

```

**Run:** `python3 threat_check.py`

---

## Script 2: Network Risk Scanner (5 minutes)

Create `risk_scanner.py`:

```python
import subprocess


def sh(a):
    return subprocess.run(a, capture_output=True, text=True)


gw = "Unknown"
for ln in sh(["ip", "route"]).stdout.splitlines():
    if ln.startswith("default "):
        gw = ln.split()[2]
        break
ping1 = lambda h: sh(["ping", "-c", "1", "-W", "1", h]).returncode == 0
print(
    f"üè† Local:{'‚úÖ' if ping1('127.0.0.1') else '‚ùå'} | üåê Router:{'‚úÖ' if gw != 'Unknown' and ping1(gw) else '‚ùå'} | üåç Internet:{'‚úÖ' if ping1('8.8.8.8') else '‚ùå'}"
)
print(f"Gateway: {gw}")
```

**Run:** `python3 risk_scanner.py`

---

## Script 3: Service Discovery Bot (5 minutes)

Create `service_bot.py`:

```python
import socket, contextlib

COMMON = [21, 22, 23, 53, 80, 110, 143, 443, 993, 995]
N = {
    "21": "FTP",
    "22": "SSH",
    "23": "TELNET",
    "53": "DNS",
    "80": "HTTP",
    "443": "HTTPS",
}


def openp(p):
    with contextlib.suppress(Exception):
        with socket.create_connection(("127.0.0.1", p), timeout=0.5):
            return True
    return False


ops = [p for p in COMMON if openp(p)]
for p in ops:
    print(f"üîì Port {p} ({N.get(str(p), 'Unknown')})")
print(f"\nüìä Security Score: {max(0, 10 - len(ops))}/10")
```

**Run:** `python3 service_bot.py`

---

## Script 4: Network Intelligence Gatherer (5 minutes)

Create `intel_gatherer.py`:

```python
import socket, subprocess


def sh(a):
    return subprocess.run(a, capture_output=True, text=True).stdout


with socket.socket(socket.AF_INET, socket.SOCK_DGRAM) as s:
    try:
        s.connect(("8.8.8.8", 80))
        my_ip = s.getsockname()[0]
    except Exception:
        my_ip = "Unknown"
hops = sum(
    1 for ln in sh(["traceroute", "-m", "5", "8.8.8.8"]).splitlines()[1:] if ln.strip()
)
svc = sh(["ss", "-tuln"])
open_all = svc.count("0.0.0.0:")
print(
    f"üè† My IP: {my_ip}\nüõ£Ô∏è  Internet hops: {hops}\nüåç Services open to world: {open_all}\n‚ö†Ô∏è  Risk level: {'HIGH' if open_all > 3 else 'MEDIUM' if open_all > 0 else 'LOW'}"
)
```

**Run:** `python3 intel_gatherer.py`

---

## Challenge: Automated Security Report

Create `security_report.py`:

```python
import socket, datetime


def openp(p):
    try:
        with socket.create_connection(("127.0.0.1", p), timeout=0.5):
            return True
    except Exception:
        return False


with socket.socket(socket.AF_INET, socket.SOCK_DGRAM) as s:
    try:
        s.connect(("8.8.8.8", 80))
        ip = s.getsockname()[0]
    except Exception:
        ip = "Unknown"
R = {22: "SSH", 23: "TELNET", 80: "HTTP", 3389: "RDP"}
ops = [p for p in R if openp(p)]
surf = "HIGH" if len(ops) > 2 else "MEDIUM" if ops else "LOW"
print(
    f"\nüîç SECURITY SCAN REPORT - {datetime.datetime.now():%Y-%m-%d %H:%M}\nüìç System IP: {ip}\nüîì Open risky ports: {len(ops)}\nüéØ Attack surface: {surf}"
)
print(
    "‚ö†Ô∏è  Exposed services: " + ", ".join(f"{p}({R[p]})" for p in ops)
    if ops
    else "‚úÖ No risky services detected"
)
```

**Run:** `python3 security_report.py`

---

## What You Learned
- **Automated scanning**: Python can check multiple security factors quickly
- **Risk assessment**: Code can evaluate and score security risks
- **Intelligence gathering**: Automate the reconnaissance attackers use
- **Robust coding**: Error handling with try/except and context managers
- **Linux integration**: Direct integration with `ip`, `ping`, `ss`, `traceroute`

**Why Python beats CLI here**: You can scan dozens of ports instantly, calculate risk scores, and generate formatted reports - much faster than manual commands!

**Code Quality Note**: These scripts use advanced Python techniques like context managers (`with` statements) and exception suppression for robust, production-style code.

---

## Quick Test
1. **Which ports indicate the highest security risk?**
2. **How does Python make vulnerability scanning more powerful than CLI?**
3. **What would happen if you ran `service_bot.py` on a web server?**

---

## Next: Week 2.2 Lesson - Network Vulnerability Assessment

**Coming up**: Learn proper `nmap` scanning techniques and build your Smart Vulnerability Analyzer that converts scan results into actionable security intelligence!