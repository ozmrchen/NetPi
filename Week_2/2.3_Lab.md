# Week 2.3 Lab: Security Monitoring with Copyparty

## Lab Overview
Set up a real file sharing service (copyparty) and monitor its security. Experience practical threat detection, log analysis, and incident response using a live service.

**Time Required:** 35 minutes  
**Environment:** Raspberry Pi 4 or GitHub Codespaces  
**Focus:** Real-world security monitoring with live service

---

## üéØ Why Copyparty for Security Learning?

**Copyparty** ([github.com/9001/copyparty](https://github.com/9001/copyparty)) is a lightweight Python HTTP file server that:
- Creates **real network traffic** you can monitor
- Generates **actual log files** showing access attempts
- Demonstrates **service exposure risks** in practice
- Shows **authentication and access control** concepts
- Provides **realistic incident response** scenarios

**Development Context**: As a Python application, copyparty demonstrates how software development choices affect security - you'll see how the developer's code decisions impact network security.

**Perfect for learning**: All monitoring theories become hands-on practice!

**üéì Teacher Customization**: The framework supports any file content, security scenarios, or attack simulations you want to demonstrate.

---

## Part 1: Deploy the "Vulnerable" Service (8 minutes)

### Step 1.1: Install and Examine Copyparty

```bash
# Install copyparty
pip3 install copyparty
# OR
uv tool run copyparty

# Check what security features the developer included
copyparty --help | grep -E "auth|password|ssl|secure"

# Examine the application
which copyparty
copyparty --version
```

**Development analysis:**
- **Security features available**: `_________________`
- **Default configuration**: Secure ‚òê / Insecure ‚òê
- **Developer choices**: `_________________`

### Step 1.2: Deploy with Basic Configuration

```bash
# Create a test directory (teacher will provide content)
mkdir ~/lab_files
# [Teacher will add files/content here]

# Start copyparty file server (accessible to network)
copyparty -v ./shared/:/:rw
```

### Step 1.3: Understand the Application Development

```bash
# Examine copyparty as a Python application
python3 -c "import copyparty; print(copyparty.__file__)"

# Check the developer's GitHub repository
curl -s https://api.github.com/repos/9001/copyparty | grep -E "language|size|stargazers"
```

**Development insights:**
- **Programming language**: Python (affects security characteristics)
- **Code repository**: Open source at [github.com/9001/copyparty](https://github.com/9001/copyparty)
- **Community**: Active development and security updates

**üîç Optional Exploration**: Visit the GitHub repository to see how the developer implements security features in the source code - great example of real-world Python application development!

**Security implications of development choices:**
- **Default port 3923**: Non-standard port (security through obscurity?)
- **No authentication by default**: Prioritises ease of use over security

**Initial Security Assessment**

**Use your Week 2 skills to evaluate the risk:**

```bash
# Scan the new service
nmap -sV -p 3923 localhost

# Check what's exposed
curl -s http://localhost:3923/
```

**Use your Week 2 skills to evaluate the deployed application:**

```bash
# Scan the new service
nmap -sV -p 3923 localhost

# Check what's exposed via web interface
curl -s http://localhost:3923/ | head -10

# Verify service is network-accessible
ss -tuln | grep :3923
```

**Application security evaluation:**
- **Service version detected**: `_________________`
- **Authentication required**: ‚òê Yes ‚òê No
- **Directory listing enabled**: ‚òê Yes ‚òê No
- **Network accessibility**: ‚òê Local only ‚òê Network-wide
- **Initial risk level**: ‚òê Low ‚òê Medium ‚òê High

---

## Part 2: Generate and Monitor Traffic (10 minutes)

### Step 2.1: Create Normal Activity

**Simulate legitimate user activity:**

```bash
# Normal file access (replace with actual filenames)
curl -s http://localhost:3923/[FILENAME1] > /dev/null
curl -s http://localhost:3923/[FILENAME2] > /dev/null

# Directory browsing
curl -s http://localhost:3923/ > /dev/null
```

### Step 2.2: Create Suspicious Activity

**Simulate potential attack patterns:**

```bash
# Rapid scanning (attacker behaviour)
for file in admin config database secret backup; do
    curl -s http://localhost:3923/$file.txt > /dev/null 2>&1
    curl -s http://localhost:3923/$file.php > /dev/null 2>&1
done

# Directory traversal attempts
curl -s "http://localhost:3923/../../../etc/passwd" > /dev/null 2>&1
curl -s "http://localhost:3923/admin/" > /dev/null 2>&1
```

### Step 2.3: Monitor the Activity

**Check copyparty logs:**

```bash
# Copyparty shows access logs in terminal where it's running
# If running in background, check with:
ps aux | grep copyparty

# Monitor network connections to your service
ss -t | grep :3923
```

**Traffic analysis:**
- **Total requests generated**: _____ (estimate)
- **Suspicious patterns observed**: `_________________`
- **Connection sources**: `_________________`

---

## Part 3: Log Analysis & Threat Detection (10 minutes)

### Step 3.1: Analyse Access Patterns

**Stop copyparty to see full logs:**

```bash
# Bring copyparty to foreground and stop it
fg
# Press Ctrl+C to stop

# Check system logs for HTTP activity
journalctl --since "10 minutes ago" | grep -i http
```

**Pattern recognition from logs:**

| Pattern Type | Example Found | Threat Level |
|-------------|---------------|--------------|
| Normal access | [Legitimate files] | ‚úÖ Legitimate |
| Rapid requests | Multiple in seconds | ‚ö†Ô∏è Scanning |
| Missing files | 404 errors | üö® Probing |
| System files | /etc/passwd | üö® Attack |

### Step 3.2: Threat Intelligence

**Categorise the activity you generated:**

**‚úÖ Legitimate Activity:**
- `_________________________________`

**‚ö†Ô∏è Suspicious Activity:**
- `_________________________________`

**üö® Malicious Activity:**
- `_________________________________`

**Key Insight**: Real attackers generate similar patterns when targeting file servers and web applications.

**Development Security Learning**: By examining how copyparty handles requests and logs access attempts, you're seeing how application developers must consider security during the development process - every feature decision affects network security monitoring requirements.

---

## Part 4: Incident Response Simulation (7 minutes)

### Step 4.1: Incident Detection

**Scenario**: Your monitoring detects someone accessing `/admin/` and `../../../etc/passwd`

**Phase 1 - Detection:**
```bash
# Check if copyparty is still running
ss -tuln | grep :3923

# Look for current connections
ss -t | grep :3923
```

**Phase 2 - Containment:**
```bash
# Stop the vulnerable service immediately
pkill -f copyparty

# Verify it's stopped
ss -tuln | grep :3923
```

**Phase 3 - Investigation:**
```bash
# Check what files were accessed
ls -la ~/lab_files/

# Look for any new files or changes (if applicable)
find ~/lab_files/ -type f -mmin -10  # Files modified in last 10 minutes
```

### Step 4.2: Document the Incident

**Create incident report:**

```bash
# Save evidence
echo "=== Security Incident Report ===" > incident_report.txt
echo "Time: $(date)" >> incident_report.txt
echo "Service: Copyparty file server" >> incident_report.txt
echo "Port: 3923" >> incident_report.txt
echo "Threat detected: Directory traversal attempts" >> incident_report.txt
echo "Response: Service stopped immediately" >> incident_report.txt

cat incident_report.txt
```

**Incident response evaluation:**
- **Detection time**: `_____` minutes after attack
- **Containment time**: `_____` seconds to stop service
- **Evidence preserved**: ‚òê Yes ‚òê No
- **Files compromised**: ‚òê Yes ‚òê No ‚òê Unknown

---

## Defence-in-Depth Assessment

### Step 5.1: Evaluate Your Security Layers

**Test each defensive layer:**

```bash
# Layer 1: Network access (who can reach port 3923?)
nmap -p 3923 localhost

# Layer 2: Service security (what protection does copyparty have?)
copyparty --help | grep -i auth

# Layer 3: File permissions (are files properly protected?)
ls -la ~/lab_files/

# Layer 4: System monitoring (can you detect access?)
echo "Monitoring capability: Working" # (you just demonstrated this!)
```

**Defence assessment:**

| Layer | Status | Effectiveness |
|-------|--------|---------------|
| Network access control | _____ | ‚òê Strong ‚òê Weak |
| Service authentication | _____ | ‚òê Strong ‚òê Weak |
| File permissions | _____ | ‚òê Strong ‚òê Weak |
| Activity monitoring | ‚úÖ Working | ‚òê Strong ‚òê Weak |

### Step 5.2: Examine Developer Security Features

**Explore what security options the copyparty developer included:**

```bash
# Check all security-related options
copyparty --help | grep -E "auth|password|ssl|secure|permission|access"

# Test with security enabled (optional demonstration)
# copyparty --help | grep -A5 -B5 "auth"
```

**Development security analysis:**
- **Authentication methods available**: `_________________`
- **Access control granularity**: `_________________`
- **Security documentation quality**: ‚òê Excellent ‚òê Adequate ‚òê Poor
- **Developer security mindset**: ‚òê Security-first ‚òê Usability-first ‚òê Balanced

### Step 5.4: Application Development Security Review

**Examine copyparty as a case study in secure development:**

```bash
# Check if developer provides security guidance
copyparty --help | grep -A3 -B3 "security\|safe\|protect"

# Look at development best practices
ls -la $(python3 -c "import copyparty; print(copyparty.__file__.replace('__init__.py', ''))")
```

**Secure development practices observed:**

**‚úÖ Good Development Practices:**
- **Open source**: Code reviewable at [github.com/9001/copyparty](https://github.com/9001/copyparty)
- **Security options**: Developer included authentication and access controls
- **Active maintenance**: Regular updates and security fixes
- **Clear documentation**: Security features are documented

**‚ö†Ô∏è Development Trade-offs:**
- **Default insecure**: Ease of deployment prioritised over security
- **Network exposure**: Allows binding to all interfaces without warnings
- **Security opt-in**: Users must actively enable security features

**Application Security Insight**: Even well-developed applications require proper configuration and monitoring to be secure in production environments.

---

## Real-World Connection: File Server Security

### What You Just Learned

**Your copyparty experiment demonstrates**:
- **Service exposure**: Any network service creates attack opportunities
- **Log analysis**: Real access patterns reveal attack attempts  
- **Incident response**: Quick containment limits damage
- **Monitoring effectiveness**: Continuous watching detects threats
- **Development impact**: How software development choices affect network security

**Software Development Security Connection**: By examining copyparty's code and configuration options, you've seen how developers must balance usability with security - and how their choices directly impact network monitoring requirements.

### Australian Context

**Similar real incidents**: Government file servers, school networks, and business systems have been compromised through similar file sharing vulnerabilities.

**Your skills apply to**: Any organisation running web services, file sharing, or network applications - plus understanding how the development teams behind these applications make security decisions.

---

## ü§î Reflection Questions

1. **Monitoring vs Prevention**: Is it more effective to monitor copyparty carefully or configure it securely from the start?

2. **Development Security**: How do the developer's design choices in copyparty affect your monitoring requirements?

3. **Real-world Application**: What monitoring techniques would you recommend for an organisation deploying copyparty in production?

---

## Lab Submission

**Complete your security monitoring assessment:**

1. **Application analysed**: Copyparty file server version `_________________` 
2. **Attack patterns detected**: `_____` different types
3. **Response time**: `_____` seconds to contain threat
4. **Most valuable monitoring technique**: `_________________`
5. **Key development security insight**: `_________________`
6. **Overall security lesson learned**: `_________________`

---

## Cleanup

```bash
# Stop any remaining copyparty processes
pkill -f copyparty

# Verify cleanup
ss -tuln | grep :3923
```

---

## Next: Week 2.3 Code Practice - Automated Security Monitor

**Coming up**: Build Python scripts that monitor services like copyparty automatically, detect attacks, and respond faster than any human could!